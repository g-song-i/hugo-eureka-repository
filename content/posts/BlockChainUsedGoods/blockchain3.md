---
title: Truffle을 이용하여 이더리움 블록체인에 스마트 컨트랙 배포하기 (3)
description: 컨트랙 배포, 결과 확인
toc: true
authors:
  - songi
tags:
  - Blockchain
  - Ethereum
  - Truffle
  - Smart contract
categories:
series: BlockChain Used Goods Trade Platform
date: '2020-05-16'
lastmod: '2020-05-16'
draft: false
---
</br>

## Content

앞서 Truffle 프로젝트를 시작하는 법, infura key를 이용해서 네트워크를 설정하는 법을 포스팅했어요. 오늘은 제가 만든 컨트랙을 보여드리면서, 배포 명령어를 통해 배포하고, 결과를 확인하는 것 까지 포스팅하려고 합니다. 
</br>
</br>
이제 남은 일은 솔리디티 문법으로 코딩을 하고, 네트워크에 배포하는 것입니다. 솔리디티 문법을 따로 포스팅하지는 않고, 제가 짠 코드를 올리고 간단히 내용만 설명하도록 할게요. 우선 프로젝트의 구조는 다음과 같습니다. 저번 포스트의 구조에서 contracts, migrations 디렉터리만 보여드리는 거에요.
</br>
</br>
<p align="center"><img src="https://user-images.githubusercontent.com/57793091/151474769-f89bf437-d032-4656-a35a-067b4d2fe36c.png"></p>
</br>
</br>
다음으로 솔리디티 코드를 보여드리기 전에 블록체인에 담고자 했던 내용을 말씀드리려고 해요. 저는 중고거래 플랫폼을 만들게 되었는데, 두 가지 정보를 블록체인에 담으려고 했어요.
</br>
</br>
 
1. 물건 등록 시 물건의 정보
2. 거래 등록 시 거래의 정보
</br>
</br>

왜냐하면 애플리케이션이 특정 사용자나 단체와 담합하여 사기를 주도할 수도 있고, 애플리케이션의 서버나 데이터베이스가 해킹당하는 경우가 있을 수 있기 때문이에요. 애플리케이션 서버에서 이러한 데이터들을 관리하는 경우, 중앙 집중형인 서버 특성상 사용자들은 애플리케이션에서 제공해주는 것들만 믿어야 하는 상황이 생깁니다. 자, 이럴 때 블록체인의 특징인 "분산 데이터베이스", "트랜잭션 조작 불가" 이런 특성들을 이용하자는 것입니다. 그래서 제가 짠 두 개의 솔리디티 파일을 보여드릴게요.
</br>
</br>
아래는 물건 정보를 기록하는 컨트랙입니다.
</br>
</br>
![img1 daumcdn](https://user-images.githubusercontent.com/57793091/151474904-71fcb6d4-1024-4e70-9abf-650bc496a2df.png)
</br>
</br>
아래는 거래 내용을 기록하는 컨트랙입니다.
</br>
</br>
![img1 daumcdn](https://user-images.githubusercontent.com/57793091/151474940-837c8064-1833-4821-8a27-b920a6d8a7e3.png)
</br>
</br>
문법은 따로 설명드리지 않는다고 했기 때문에, 제가 어떤 데이터를 넣으려고 했는지 이런 것만 보시면 될 것 같아요. 몇 가지 주의 드릴 것은 mapping이라는 특별한 속성은 자바의 hashMap같이 데이터를 묶어주는 역할을 해요. 저는 uint256 type의 데이터를 제가 생성한 struct와 매핑시켜서 넘버를(위에서는 물건 등록 넘버, 아래에서는 거래 등록 넘버) 구조체에 매핑시키는 역할을 합니다. 
</br>
</br>
또 한 가지 주의할 것은 컨트랙에서는 지역 변수의 개수/ 파라미터의 개수/ 리턴 파라미터의 개수 이렇게 세 가지 파라미터가 transaction fee에 영향을 미쳐요. 제 위에 코드에서 보시면 setObject에서 파라미터가 7개, 아래 getObject에서 리턴 파라미터가 7개 이므로 총 14개의 파라미터를 가지는 것으로 계산을 하게 됩니다. 그런데 제가 알기로는, 파라미터가 16개를 넘기면 fee limit을 넘기게 될 거예요. 그래서 그런 경우 컴파일을 할 때, 솔리디티 파일을 나누라는 에러가 뜰 수도 있어요. 파라미터 개수에 주의하시기 바랍니다!
</br>
</br>
그러면 우리는 모든 컨트랙을 코딩했고, 배포할 일만 남았다고 생각할게요. migrations는 폴더에 아래와 같이 자신이 만든 솔리디티 파일을 배포할 모듈을 만들어 주시면 됩니다. js파일의 이름은 상관 없어요. artifacts.require(''); 이 안에는 솔리디티 파일의 이름을 써주세요. 저는 솔리디티 파일 이름이 RegisterObject.sol인 거예요.
</br>
</br>
아래는 2_deploy_registerObject.js 코드입니다.
</br>
</br>
<p align="center"><img src="https://user-images.githubusercontent.com/57793091/151475249-daa05906-4fb9-4329-a82c-d6e510de7381.png"></p>
</br>
</br>
아래는 3_deploy_transaction.js 코드입니다.
</br>
</br>
<p align="center"><img src="https://user-images.githubusercontent.com/57793091/151475338-eac35d96-0468-4d61-b076-5bf20af9a4cb.png"></p>
</br>
</br>
이제 배포해보겠습니다. cmd를 켜고 해당 디렉터리로 이동한 후 다음 명령어를 입력합시다.

    truffle migrate --network ropsten

migrate라는 명령어는 컴파일 + 배포까지 해주는 명령어예요. 만약 여러분이 솔리디티 파일을 잘못 코딩할 경우 바로 배포되지 않고 컴파일에서 걸립니다. 그러니까 안심! 컴파일이 다 되었다면 배포는 잘 되었고 블록 넘버는 몇 번이다. 해시 값은 뭐이며 그래서 비용은 얼마가 나왔다- 이런 내용이 나올 거예요. 원래는 배포가 완료된 사진이 있었는데 사진을 잃어버려서 부득이하게 첨부하지 못했습니다 ㅠㅜ
</br>
</br>
여기 있는 값은 굳이 복사해놓거나 하실 필요가 없습니다. 이더스캔에서 확인할 수 있거든요! 이더스캔으로 트랜잭션을 확인하는 건 굳이 설명하지 않겠습니다. 다만 이더스캔은 네트워크마다 페이지가 다르니, 이더스캔 ropsten 페이지 링크를 걸어 놓을게요. 여기서 truffle-config에 사용하신 메타마스크 계정을 입력하면 해당 계정에서 발행된 트랜잭션을 모두 확인 가능합니다.

https://ropsten.etherscan.io

다음 포스트에는 마지막으로 js 서버에서 web3 js 모듈을 통해 해당 트랜잭션에 접근해 정보를 삽입하고, 가져오는걸 포스트 하려고 합니다!

## Recent comment
제가 약간 무지성으로 이전 블로그 글을 이전하고 있는데, 이 부분에 대해서는 실제 블록체인 회사에서 인턴을 했던 친구가 실제로 이런 형태로 스마트 컨트랙을 사용하는 것의 효용성에 대한 얘기를 해주었던 것 같은데 그것도 오래전이라 잘 기억이 안나네요 ㅠㅡㅠ 사용법 정도만 봐주시면 좋을 것 같아요!